#!/bin/bash

##########################################################################################
##########################################################################################
##########################################################################################
#  UBUNTU: FSE CLIENT INSTALLER
##########################################################################################
#				                              version 1.0
##########################################################################################
#
#				                        created by: James White
#				                                 CIDSE
#				                        Arizona State University
#				                        last updated July 11, 2018
#
##########################################################################################
##########################################################################################
##########################################################################################
##########################################################################################

##########################################################################################
##########################################################################################
##########################################################################################
########################          Add Repositories              ##########################
##########################################################################################

sudo wget -O - http://repo.pbis.beyondtrust.com/apt/RPM-GPG-KEY-pbis | sudo apt-key add - 
sudo wget -O /etc/apt/sources.list.d/pbiso.list http://repo.pbis.beyondtrust.com/apt/pbiso.list 


##########################################################################################

##########################################################################################
##########################################################################################
#########################            UPDATE & UPGRADE           ##########################
##########################################################################################
apt-get update && apt-get -y upgrade

##########################################################################################
##########################           Install PBIS Client        ##########################
##########################################################################################

apt-get install pbis-open -y

##########################################################################################


##########################################################################################
##########################        Install Landscape Client      ##########################
##########################################################################################

apt install landscape-client -y

##########################################################################################


##########################################################################################
##########################            SET HOSTNAME              ##########################
##########################################################################################

#Assign existing hostname to $hostn
hostn=$(cat /etc/hostname)

#Display existing hostname
#echo "The current hostname of this systems is $hostn"

#Ask for new hostname $newhost

echo " ******************************************************************************"
echo " ******************************************************************************"
echo " Please enter the desired hostname for this system: "
read newhost
echo " ******************************************************************************"
echo " ******************************************************************************"
#change hostname in /etc/hosts & /etc/hostname
sed -i "s/$hostn/$newhost/g" /etc/hosts
sed -i "s/$hostn/$newhost/g" /etc/hostname
echo " **********************************************************************************"
echo " **********************************************************************************"
#display new hostname
echo "Your new hostname is $newhost"
echo " **********************************************************************************"
echo " **********************************************************************************"

hostname $newhost


##########################################################################################
#################################   ACTIVE DIRECTORY  ####################################
##########################################################################################
echo " **********************************************************************************"
echo " **********************************************************************************"
echo " **********************************************************************************"
echo " *************                 **WARNING**                   **********************"
echo " **********************************************************************************"
echo " **********************************************************************************"
echo " *************      ALL NEW SYSTEMS MUST BE PRE-STAGED       **********************"
echo " *************         WITHIN ACTIVE DIRECTORY               **********************"
echo " **********************************************************************************"
echo " **********************************************************************************"
echo " *************   ARE YOU SETTING UP AN EXISTING SYSTEM ???   **********************"
echo " *************         PLEASE VERIFY THAT THE DEVICE         **********************"
echo " *************            IS IN THE PROPER OU                **********************"
echo " **********************************************************************************"

##########################################################################################
##############################    Verify AD PreStage    ##################################
##########################################################################################
#Require the technician to verify whether or not the computer has been prestaged in AD. 
echo " **********************************************************************************"
echo " **********************************************************************************"
echo " *"
echo " *"
read -p " *  Has this computer already been pre-staged in Active Directory? (Y)es/(N)o?  " choice
case "$choice" in 
  y|Y ) echo "yes";;
  n|N ) echo "****************************************************************************"
        echo "****************************************************************************"
        echo "****************************************************************************"
        echo "        UBUNTU CLIENT CONFIGURATION CAN NOT BE RUN AT THIS TIME :(          "
        echo "Please pre-stage this system in Active Directory, with the desired hostname"
        echo "****************************************************************************"; return;;
  * ) echo "invalid"; return;;
esac
echo " **********************************************************************************"
echo " **********************************************************************************"

################################################################################################
#################################   Department Info.    ########################################
################################################################################################



################################################################################################


################################################################################################
################################################################################################
#############################   GET NEW CLIENT CONFIGURATION             #######################
################################################################################################

cp /mnt/source/linux/ubuntu/config/cidse/workstation/workstation_config.sh /tmp/

rm /home/techs/Desktop/fse_provisioning.txt
touch /var/log/fse/fse_provisioning.txt

################################################################################
#####################       RUN POST-CONFIG SCRIPT.      #######################
################################################################################

sh /tmp/workstation_config.sh  --verbose



##########################################################################################
##########################################################################################
################################        CLEANUP         ##################################
##########################################################################################
##########################################################################################
##########################################################################################
rm /install
rm /home/techs/Desktop/firstinstallstarted.txt
touch /var/log/fse.log

##########################################################################################

service lightdm restart
