
#!/bin/bash

################################################################################################
################################################################################################
################################################################################################
#			                   Install and Register Landscape
################################################################################################
#				                       version 1.0
################################################################################################
#				                 created by: James White
#				                       	CIDSE
#				                 Arizona State University
#				                last updated June 20, 2018
################################################################################################
################################################################################################
apt-get update && apt-get -y upgrade
##########################################################################################
######################                   CIFS-UTILS                  #####################
##########################################################################################

apt install cifs-utils -y

##########################################################################################
######################            MOUNT SOURCE FILESHARE	         #####################
##########################################################################################

echo “Installing CIFS-UTILS”
apt-get install cifs-utils -y

echo “Making New Source Directory”
mkdir /mnt/source/

echo “Mounting CIDSE-FS-01”
mount.cifs //cidse-fs-01.cidse.dhcp.asu.edu/Source /mnt/source -o vers=3.0,username=deploy,domain=cidse-fs-01,password=hiywabk2DAY!


##########################################################################################
#######################            COPY INSTALL DIRECTORY        #########################
##########################################################################################

cp -a /mnt/source/linux/ubuntu/preseed/ubuntusata/preseed/install /tmp/

##########################################################################################
#######################            ADD PBIS Client Repo        ###########################
##########################################################################################

wget -O - http://repo.pbis.beyondtrust.com/apt/RPM-GPG-KEY-pbis|sudo apt-key add - 
sudo wget -O /etc/apt/sources.list.d/pbiso.list http://repo.pbis.beyondtrust.com/apt/pbiso.list 
sudo apt-get update
echo $(date) ${filename} SUCCESS: PBIS-OPEN Repo Added >> /var/log/fse.log

##########################################################################################
##########################           Install PBIS Client        ##########################
##########################################################################################

apt-get install pbis-open -y
echo $(date) ${filename} SUCCESS: PBIS-OPEN Installed >> /var/log/fse.log


##########################################################################################
##########################     Install Landscape Client         ##########################
##########################################################################################

apt install landscape-client -y
echo $(date) ${filename} SUCCESS: Landscape-Client Installed >> /var/log/fse.log



##########################################################################################
##########################################################################################
##########################################################################################
######################	             PRE-CONFIGURE                       #################
######################	     	    LANDSCAPE CLIENT       	             #################
##########################################################################################
##########################################################################################
##########################################################################################
##########################################################################################
##########################################################################################

##########################################################################################
################       Make backup of default client.conf    #############################
##########################################################################################

mv /etc/landscape/client.conf /etc/landscape/client.conf.bak

##########################################################################################
################ Write Client.txt data to the client.conf file ###########################
##########################################################################################

cp /tmp/install/fse/landscape/client.conf /etc/landscape/

##########################################################################################
##################################  CONFIGURE .host FILE     #############################
##########################################################################################

cat /tmp/install/fse/landscape/addhost.txt >> /etc/hosts

##########################################################################################

##########################################################################################
##########################   Configure /etc/landscape/ directory  ########################
##########################################################################################

##### Copying Landscape License File #####
cp /tmp/install/fse/landscape/license.txt /etc/landscape/

##### Copy Landscape SSL Cert to /etc/landscape #####
cp /tmp/install/fse/landscape/landscape_server.pem /etc/landscape/



##########################################################################################
##########################################################################################
##########################  Request Client registration from Landscape  ##################
##########################################################################################
##########################################################################################

echo “Beginning Landscape Configuration”
landscape-config --computer-title $(hostname -f) --script-users nobody,landscape,root --silent

